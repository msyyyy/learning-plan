# Linux基础

## 1.帮助命令

`man command`   查看命令具体参数

`whatis command` 查看简短说明

`which  command` 查看程序安装路径

`whereis command` 查看程序的搜索路径

whereis命令只能用于程序名的搜索，而且只搜索二进制文件（参数-b）、man说明文件（参数-m）和源代码文件（参数-s）。如果省略参数，则返回所有信息。

## 2.文件及目录管理

- 创建：`mkdir`
- 删除：`rm`
- 删除非空目录：`rm -rf file目录`
- 删除日志 `rm *log `(等价: $find ./ -name “*log” -exec rm {} ;)
- 移动：`mv`
- 复制：`cp (复制目录：cp -r )`

查看当前目录下文件个数:  `find ./ | wc -l`

- 找到文件/目录位置：`cd`
- 切换到上一个工作目录： `cd -`
- 切换到home目录：` cd or cd ~`
- 显示当前路径: `pwd`
- 更改当前工作路径为`path: $cd path`

### 2.1find

查找目标文件夹中是否有obj文件

`find ./ -name "*.o"`

递归当前目录及子目录删除所有.o文件:

`find ./ -name "*.o" -exec rm {} \;`

`locate`比`find`更快 ，因为locate不是实时的，是索引数据库，可以使用`updatedb`更新

###  2.2查看文件内容

`cat` 

`cat -n`   打印 并显示行号 

`more` 按页显示内容

`cat a| more`

`head -5 filename` 显示前5行、

`tail-5 filename `  显示后5行

`diff filename1 filename2` 显示两个文件间差别

### 2.3查找文件内容

```
grep命令

基本格式：grep  expression

1.主要参数

[options]主要参数：
－c：只输出匹配行的计数。
－i：不区分大小写
－h：查询多文件时不显示文件名。
－l：查询多文件时只输出包含匹配字符的文件名。
－n：显示匹配行及行号。
－s：不显示不存在或无匹配文本的错误信息。
－v：显示不包含匹配文本的所有行。
 -R: 在多级目录中对文本递归搜索

pattern正则表达式主要参数：
\： 忽略正则表达式中特殊字符的原有含义。
^：匹配正则表达式的开始行。
$: 匹配正则表达式的结束行。
\<：从匹配正则表达 式的行开始。
\>：到匹配正则表达式的行结束。
[ ]：单个字符，如[A]即A符合要求 。
[ - ]：范围，如[A-Z]，即A、B、C一直到Z都符合要求 。
.：所有的单个字符。
* ：有字符，长度可以为0。

2.实例　 

(1)grep 'test' d*　　#显示所有以d开头的文件中包含 test的行
(2)grep ‘test’ aa bb cc 　　 #显示在aa，bb，cc文件中包含test的行
(3)grep ‘[a-z]\{5\}’ aa 　　#显示所有包含每行字符串至少有5个连续小写字符的字符串的行
(4)grep magic /usr/src　　#显示/usr/src目录下的文件(不含子目录)包含magic的行
(5)grep -r magic /usr/src　　#显示/usr/src目录下的文件(包含子目录)包含magic的行

(6)grep -w pattern files ：只匹配整个单词，而不是字符串的一部分(如匹配’magic’，而不是’magical’)，
```

### 2.4文件与目录权限修改

- 改变文件的拥有者 `chown`

- 改变文件读、写、执行等属性 `chmod`

- 递归子目录修改： `chown -R tuxapp source/`

- 增加脚本可执行权限：` chmod a+x myscript`

  - u：用户
  - g：组
  - o：其它用户
  - a：所有用户

  +(加入) 

  u+w 

 -(除去) 

  u-w =(设定)

  u=rwx

### 2.5别名

```
ln cc ccAgain :硬连接；删除一个，将仍能找到；
ln -s cc ccTo :符号链接(软链接)；删除源，另一个无法使用；（后面一个ccTo 为新建的文件）
```

### 2.6管道和重定向

- 批处理命令连接执行，使用` |`
- 串联: 使用分号 `;`
- 前面成功，则执行后面一条，否则，不执行:`&&`
- 前面失败，则后一条执行: `||`

重定向

`ls  proc/*.c > list 2> list 将标准输出和标准错误重定向到同一文件；`,1 代表标准输出， 2 代表标准从错误  ， > 相当于 1> 

上一条命令相当于`ls  proc/*.c &> list`

清空文件 `:> a.txt`

在文件后添加  `echo aa >> a.txt`

## 3.文本处理

### 3.1 Find

**按名字搜索  -name**

查找txt和pdf文件

`find . \( -name "*.txt" -o -name "*.pdf" \) -print`

**参数有： ！，-and(-a)，-or(-o)。**

`find . -type d -print  //只列出所有目录`

`find . -maxdepth 1 -type f` 指定搜索深度,打印出当前目录的文件（深度为1）:

**按类型搜索   -type f 文件   l 符号链接   d 目录 **  

实现查找本地目录下的所有二进制文件:

`ls -lrt | awk '{print $9}'|xargs file|grep  ELF| awk '{print $1}'|tr -d ':'`

**按时间搜索**

- -atime 访问时间 (单位是天，分钟单位则是-amin，以下类似）
- -mtime 修改时间 （内容被修改）
- -ctime 变化时间 （元数据或权限变化）

最近第7天被访问过的所有文件:

```
find . -atime 7 -type f -print
```

最近7天内被访问过的所有文件:

```
find . -atime -7 -type f -print
```

查询7天前被访问过的所有文件:

```
find . -atime +7 type f -print
```

**按大小搜索**

w字 k M G 寻找大于2k的文件:

```
find . -type f -size +2k
```

**按权限查找**

```
find . -type f -perm 644 -print //找具有可执行权限的所有文件
```

**按用户查找:**

```
find . -type f -user weber -print// 找用户weber所拥有的文件
```

#### 找到后的后续动作

**1. 删除**

删除当前目录下所有的swp文件:

```
find . -type f -name "*.swp" -delete
```

或者

```
find . -type f -name "*.swp" | xargs rm
```

**2. 执行动作   exec**

将当前目录下的所有权变更为weber:

```
find . -type f -user root -exec chown weber {} \;
```

**注：{}是一个特殊的字符串，对于每一个匹配的文件，{}会被替换成相应的文件名；**

将找到的文件全都copy到另一个目录:

```
find . -type f -mtime +10 -name "*.txt" -exec cp {} OLD \;
```

- 结合多个命令

如果需要后续执行多个命令，可以将多个命令写成一个脚本。然后 -exec 调用时执行脚本即可:

```
-exec ./commands.sh {} \;
```

**-print的定界符**

默认使用’\n’作为文件的定界符；

-print0 使用’\0’作为文件的定界符，这样就可以搜索包含空格的文件；

### 3.2 排序，消除重复行

`sort` 

- -n 按数字进行排序 VS -d 按字典序进行排序
- -r 逆序排序
- -k N 指定按第N列排序
- -b 忽略像空格之类的前导空白字符

`uniq`

- 消除重复行

```
sort unsort.txt | uniq
```

- 统计各行在文件中出现的次数

```
sort unsort.txt | uniq -c
```

- 找出重复行

```
sort unsort.txt | uniq -d
```

### 3.3 tr进行转换

- 通用用法

```
echo 12345 | tr '0-9' '9876543210' //加解密转换，替换对应字符
cat text| tr '\t' ' '  //制表符转空格
```

- tr压缩字符

tr -s 压缩文本中出现的重复字符；最常用于压缩多余的空格:

```
cat file | tr -s ' '
```

### 3.4 paste 按列拼接

```
root@yyw:~/test# cut -c1-5 a
a
a
bb
bb
bbb
root@yyw:~/test# cat b
bbb
ddd

root@yyw:~/test# paste a b
a	bbb
a	ddd
bb	
bb	
bbb	
```

### 3.5. wc 统计行和字符的工具

```
$wc -l file // 统计行数

$wc -w file // 统计单词数

$wc -c file // 统计字符数
```

### 3.6 sed 文本替换

- 首处替换   

```
root@yyw:~/test# cat a
a
a
bb
bb
bbb
root@yyw:~/test# sed 's/b/d/' a     //将每一行第一个匹配的b换成d
a
a
db
db
dbb

root@yyw:~/test# sed 's/b/d/g' a    //全局替换
a
a
dd
dd
ddd

```

默认替换后，输出替换后的内容，如果需要直接替换原文件,使用-i:

- 移除空白行

```
sed '/^$/d' file
```

- 已匹配的字符串通过标记&来引用.

```
echo this is en example | sed 's/\w+/[&]/g'
$>[this]  [is] [en] [example]
```

### 3.7 awk数据流处理

- awk脚本结构

```
awk ' BEGIN{ statements } statements2 END{ statements } '
```

- 工作方式

1.执行begin中语句块；

2.从文件或stdin中读入一行，然后执行statements2，重复这个过程，直到文件全部被读取完毕；

3.执行end语句块；

- 使用不带参数的print时，会打印当前行

```
echo -e "line1\nline2" | awk 'BEGIN{print "start"} {print } END{ print "End" }'
```

```
root@yyw:~/test# echo -e "line1\nline2" | awk 'BEGIN{print "start"} {print } END{ print "End" }'
start
line1
line2
End
```

- print 以逗号分割时，参数以空格定界;

```
echo | awk ' {var1 = "v1" ; var2 = "V2"; var3="v3"; \
print var1, var2 , var3; }'


$>v1 V2 v3
```

- 使用-拼接符的方式（”“作为拼接符）;

```
echo | awk ' {var1 = "v1" ; var2 = "V2"; var3="v3"; \
print var1"-"var2"-"var3; }'


$>v1-V2-v3
```

- 特殊变量： NR NF $0 ​$1 $2

NR:表示记录数量，在执行过程中对应当前行号；

NF:表示字段数量，在执行过程总对应当前行的字段数；

$0:这个变量包含执行过程中当前行的文本内容；

$1:第一个字段的文本内容；

$2:第二个字段的文本内容；

```
echo -e "line1 f2 f3\n line2 \n line 3" | awk '{print NR":"$0"-"$1"-"$2}'
```

```
root@yyw:~/test# echo -e "line1 f2 f3\n line2 \n line 3" | awk '{print NR":"$0"-"$1"-"$2}'
1:line1 f2 f3-line1-f2
2: line2 -line2-
3: line 3-line-3

root@yyw:~/test# echo -e "line1 f2 f3\n line2 \n line 3" | awk '{print NF":"$0"-"$1"-"$2}'
3:line1 f2 f3-line1-f2
1: line2 -line2-
2: line 3-line-3

```

## 4 磁盘管理

查看磁盘空间利用大小:

```
df -h
```

查看当前目录所占空间大小:

```
du -sh
```

**打包**

打包是将多个文件归并到一个文件:

```
tar -cvf etc.tar /etc <==仅打包，不压缩！
```

- -c :打包选项
- -v :显示打包进度
- -f :使用档案文件

**压缩**

```
$gzip demo.txt
```

生成 demo.txt.gz

**解包**

```
tar -xvf demo.tar
```

-x 解包选项

  `tar -jxvf demo.tar.bz2`

`tar -zxvf demo.tar.gz`

tar解压参数说明：

- -z 解压gz文件
- -j 解压bz2文件
- -J 解压xz文件

`dpkg -i `安装deb包

## 5. 进程管理

### 5.1 查询进程

`ps -ef`

- 查询归属于用户colin115的进程

```
$ps -ef | grep colin115
$ps -lu colin115
```

- 查询进程ID（适合只记得部分进程字段）

```
$pgrep 查找进程

eg:查询进程名中含有re的进程
[/home/weber#]pgrep -l re
2 kthreadd
28 ecryptfs-kthrea
29515 redis-server
```

- 显示进程信息，并实时更新

```
$top
```

- 查看端口占用的进程状态：

```
lsof -i:3306
```

- 杀死指定PID的进程 (PID为Process ID)

```
$kill PID
```

`killall [-iIe] [command name] `杀死进程,靠名字

### htop

F9 杀死进程

P  按cpu 排序

M 按内存排序

## 6 性能监控

查看CPU使用率

`sar -u 1 2`  后面的两个参数表示监控的频率，比如例子中的1和2，表示每秒采样一次，总共采样2次；

查看内存使用状况 sar指定-r之后，可查看内存使用状况;

`sar -r 1 2`

查看内存使用量

`free -m`

查看页面交换发生状况 页面发生交换时，服务器的吞吐量会大幅下降；服务器状况不良时，如果怀疑因为内存不足而导致了页面交换的发生，可以使用sar -W这个命令来确认是否发生了大量的交换；

```
$sar -W 1 3
```

## 7 网络工具

### 7.1 镜像下载

```
wget url
```

常用选项:

- –limit-rate :下载限速
- -o：指定日志文件；输出都写入日志；
- -c：断点续传

### 7.2. ftp sftp lftp ssh

SSH登陆:

```
$ssh ID@host
```

ssh登陆远程服务器host，ID为用户名。

ftp/sftp文件传输:

```
$sftp ID@host
```

登陆服务器host，ID为用户名。sftp登陆后，可以使用下面的命令进一步操作：

- get filename # 下载文件
- put filename # 上传文件
- ls # 列出host上当前路径的所有文件
- cd # 在host上更改当前路径
- lls # 列出本地主机上当前路径的所有文件
- lcd # 在本地主机更改当前路径

lftp同步文件夹(类似rsync工具):

```
lftp -u user:pass host
lftp user@host:~> mirror -n
```

将本地localpath指向的文件上传到远程主机的path路径:

```
$scp localpath ID@host:path
```

以ssh协议，遍历下载path路径下的整个文件系统，到本地的localpath:

```
$scp -r ID@site:path localpath
```

## 8 用户管理工具

- 创建用户

```
$useradd -m username
```

该命令为用户创建相应的帐号和用户目录/home/username；

用户添加之后，设置密码：

密码以交互方式创建:

```
$passwd username
```

- 删除用户

```
$userdel -r username
```

不带选项使用 userdel，只会删除用户。用户的家目录将仍会在/home目录下。要完全的删除用户信息，使用-r选项；

- 帐号切换 登录帐号为userA用户状态下，切换到userB用户帐号工作:

```
$su userB
```

进入交互模型，输入密码授权进入；





默认情况下，添加用户操作也会相应的增加一个同名的组，用户属于同名组； 查看当前用户所属的组:

```
$groups
```

一个用户可以属于多个组，将用户加入到组:

```
$usermod -G groupNmame username
```

变更用户所属的根组(将用加入到新的组，并从原有的组中除去）:

```
$usermod -g groupName username
```

系统的所有用户及所有组信息分别记录在两个文件中：/etc/passwd , /etc/group 默认情况下这两个文件对所有用户可读：

查看所有用户及权限:

```
$more /etc/passwd
```

查看所有的用户组及权限:

```
$more /etc/group
```

### 用户权限

使用ls -l可查看文件的属性字段，文件属性字段总共有10个字母组成，第一个字母表示文件类型，如果这个字母是一个减号”-”,则说明该文件是一个普通文件。字母”d”表示该文件是一个目录，字母”d”,是dirtectory(目录)的缩写。 后面的9个字母为该文件的权限标识，3个为一组，分别表示文件所属用户、用户所在组、其它用户的读写和执行权限；

userMark取值：

- u：用户
- g：组
- o：其它用户
- a：所有用户

PermissionsMark取值：

- r:读
- w：写
- x：执行

```
$chmod a+x main         对所有用户给文件main增加可执行权限
$chmod g+w blogs        对组用户给文件blogs增加可写权限
```

数字方式：

数字方式直接设置所有权限，相比字母方式，更加简洁方便；

使用三位八进制数字的形式来表示权限，第一位指定属主的权限，第二位指定组权限，第三位指定其他用户的权限，每位通过4(读)、2(写)、1(执行)三种数值的和来确定权限。如6(4+2)代表有读写权，7(4+2+1)有读、写和执行的权限。

例如:

```
$chmod 740 main     将main的用户权限设置为rwxr-----
```

-  更改文件或目录的拥有者

```
$chown username dirOrFile
```

使用-R选项递归更改该目下所有文件的拥有者:

```
$chown -R weber server/

chown [–R] 属主名 文件名
chown [-R] 属主名：属组名 文件名
```

## 9 系统管理及IPC资源管理

查看Linux系统版本:

```
$uname -a
$lsb_release -a
```

查询CPU信息:

```
$cat /proc/cpuinfo
```

查看CPU的核的个数:

```
$cat /proc/cpuinfo | grep processor | wc -l
```

显示架构:

```
$arch
```

`x86_64`

查看内存信息:

```
$cat /proc/meminfo
```

显示当前系统时间:

```
$date
```

设置系统日期和时间(格式为2014-09-15 17:05:00):

```
$date -s 2014-09-15 17:05:00
$date -s 2014-09-15
$date -s 17:05:00
```

设置时区:

```
选择时区信息。命令为：tzselect
根据系统提示，选择相应的时区信息。
```

强制把系统时间写入CMOS（这样，重启后时间也正确了）:

```
$clock -w
```

格式化输出当前日期时间:

```
$date +%Y%m%d.%H%M%S
>20150512.173821

yyy@yyw:~/test$ date +%Y-%m-%d.%H--%M--%S
2019-05-27.15--47--06
```

# 2 linux工具进阶

### ssh

- 生成密钥 ` ssh-keygen`

  最后会在~/.ssh 下生成 .pub文件 公钥和私钥

  ```
  # ssh-keygen
  centos7 生成密钥，一路回车，复制公钥到 centos72、centos73 的 .ssh/authorized_keys.
  修改 authorized_keys 权限为 600
  ```

  

- `ssh-agent bash`   启动sh-agent

- `ssh-add`  添加私钥

- `ssh -A  yyy@118.24.197.134` 连接服务器

要使用`sudo`必须满足两个条件 1. 知道当前登陆用户密码 2. 当前用户在sudo用户组