- [计算机网络和因特网](#1)
    - [什么是因特网](#1-1)
    - [网络边缘](#1-2)
    - [网络核心](#1-3)
    - [分组交换网中的时延，丢包和吞吐量](#1-4)
    - [协议层次及其服务模型](#1-5)
    - [面对攻击的网络](#1-6)
- [应用层](#2)
    - [应用层协议原理](#2-1)
    - [Web和HTTP](#2-2)
    - [因特网中的电子邮件](#2-3)

<h1 id='1'>计算机网络和因特网</h1>

<h2 id='1-1'>什么是因特网</h2>

> 1. 描述具体构成 (基本硬件和软件)
 
端系统通过通信链路和分组交换机连接到一起，最著名的两种分组交换机为路由器(用于网络核心)和链路层交换机(用于接入网中)

端系统通过因特网服务提供商（ISP）接入因特网

TCP(传输控制协议)，IP(网际协议)

> 2. 为分布式应用提供服务的联网基础设施

what分布式应用程序: 涉及多个相互交换数据的端系统的应用程序

套接字接口,该接口规定了运行在一个端系统上的程序请求因特尔基础设施向运行在另一个端系统上的特定目的地程序发生数据的方式

> 协议

what： 定义了在两个或多个通信实体之间交换的报文的格式和顺序，以及报文发生和/或接收一条报文或其他事件所采取的动作

<h2 id='1-2'>网络边缘</h2>

主机被分为客户和服务器
### 接入网
what接入网： 将端系统物理连接到其边缘路由器的网络

1. 家庭接入
```
DSL(数字用户线)

因特网服务提供商（ISP）： 本地电话接入的本地电话公司
调制解调器： 现有电话线(双绞铜线)
交换数据的对象： 位于电话公司的本机中心局中的数字用户线接入复用器(DSLAM)
交换过程： 数字信号 -> ( DSL调制解调器 )-> 高频音（模拟信号） -> (电话线传输到本地中心局) -> 在DSLAM处转换回数字信号
速度：12Mbps下行 1.8Mbps上行 (1999)  55Mbps下行 15Mbps上行 (2006) 
局限： 速度慢，距离限制
```
```
电缆因特网接入,混合光纤同轴系统

ISP： 提供有线电视的公司
调制解调器: 电缆调制解调器
交换数据的对象: 电缆调制解调器端接系统(CMTS，公司处)
特征： 共享广播媒体(每个家庭都通过上行信道向头部传输 ，都通过下行信道接收数据 所以可能网速可能较慢且需要分布式多路访问协议来协调传输和避免碰撞)
速度：42.8Mbps 下行 30.7Mbps 上行
```
```
光纤到户(FTTH)

what: 从本地中心局直接到家庭提供一条光纤路径
分类： 主动光纤网络(AON，本质是交换因特网)   被动光纤网络(PON)

PON：
过程： 每个家庭具有一个光纤网络端接器(ONT)，由光纤连接到临近分配器，分配器把他们集结到一根共享的光纤，在连接到本地电话和公司的中心局的光纤线路端接器(OLT)，通过OLT进行光信号到电信号的转化，通过公司路由器和因特网相连。从OLT发送到分配器的分组在分配器处复制
速度:用户平均下行速度20Mbps

```
```
拨号 和 卫星
```

2. 企业(和家庭)接入 以太网和wifi 

使用局域网(LAN)将端系统连接到边缘路由器

3. 广域和无线接入 ： 3G 和 LTE

### 物理媒体

what： 在因特网中使用的传输媒体

分类： 导引型媒体（固体媒体） 和 非导引型媒体(空气或外层空间)

<h2 id='1-3'>网络核心</h2>

what: 互联因特网端系统的分组交换机和链路构成的网状网络

通过网络链路和交换机移动数据有两个基本方法：电路交换，分组交换

### 分组交换 : 按需分配


`分组`： 为了从源端系统向目的端系统发送一个报文，源将长报文划分为较小的数据块

分组通过通信链路和分组交换机传送，每个分组以等于该链路的最大传输速率的速度传输通过通信链路。

`存储转发传输`： 交换机能够开始向输出链路传输该分组的第一个比特前，必须接收到整个分组

所以N条速率均为R的链路组成的路径，端到端时延为 N*L/R

`排队时延`：分组交换机有输出缓存（输出队列） ，有正在传输的分组，其他分组必须在输出缓存中等待

`分组丢失(丢包)`: 缓存空间有限，一个到达的分组可能发现缓存都被其他等待传输的分组占满了，所以就会丢失

> 路由器如何选择分组向哪条链路转发 ？  `转发表`和`路由选择协议`

每台路由有转发表，用于将目的地址(或目的地址一部分)映射成输出链路，因特网有路由选择协议,自动设置转发表

### 电路交换

在电路交换网络中，在端系统间通信会话期间，预留了端系统间沿路径通信所需要的资源(缓存，链路传输资源)，因为预留了宽带所以发送方能以恒定速率向接收方传送数据

端到端的电路传输时间与链路数量无关

链路中的电路通过频分复用(FDM) 或 时分复用 (TDM) 实现

FDM: 每条电路连续获得部分带宽   TDM: 每条电路在时隙中周期性(周期为一帧)获得全部带宽

#### 网络的网络

等级化网络 ： 多层的ISP 

增加存在点(POP)： what： 提供商网络中的一台或多台路由器群组，客户ISP 通过 提供商POP 连接 提供商ISP ，客户ISP通过第三方电信提供商租用高速链路将他的路由器之一直接链接到该POP的一台路由器 

客户ISP可以`多宿`，即选择多个提供商ISP，使一个提供商出现意外后仍能提供服务，为了减少费用(因为ISP支付给供应商的费用反映他通过供应商交换的通信流量)  客户ISP会选择和临近同一等级ISP `对等` ，使他们流量直接连接而不通过上游ISP传输 ，所以第三方公司创建 因特网交换点(IXP)，IXP是一个汇合点，多个ISP能在此对等

内容提供商网络：如谷歌 内容提供商与较低层ISP对等或者在IXP处与他们对等，尝试创建自己的网络，绕过第一层ISP，不过有些接入ISP只能通过第一层连接 所以 内容提供商也与第一层连接 不过仅仅为这些ISP交换的流量付费。

<h2 id='1-4'>分组交换网中的时延，丢包和吞吐量</h2>

#### 分组交换网中的时延概念

分类： 节点处理时延， 排队时延，传输时延，传播时延 

传输时延和传播时延的比较： 传输时延：路由器推出分组所需时间(取决于分组长度和链路传输速率)      传播时延：一个比特从一台路由器传输到另一台路由器所需时间(两台路由器之间距离的函数)

#### 排队延时和丢包

分组到达队列的平均速率(a) ， 传输速率(R)即从队列中推出比特的速率  ， 分组长度 L比特 那么 La/R被称为`流量强度`, 流量强度不能大于1 ，因为不然排队时延会趋于无穷大(比特到达速率超过传输速率)

丢包： 链路有着有限容量，满时，新队列到达时将会被丢弃

#### 端到端时延

Traceroute程序

#### 端系统，应用程序和其他时延

媒体分组化时延： IP语音中(VoIP) ，发送方在向因特网传递分组之前必须首先用编码的数字化语音填充一个分组。这种填充一个分组的时间称之位分组化时延。

#### 计算机网络中的吞吐量

瞬间吞吐量： 接收文件的速率

吞吐量不仅取决于沿着路径的传输速率，也取决与干扰流量(例如 有多个用户同时下载)

<h2 id='1-5'>协议层次及其服务模型</h2>

#### 协议分层

每层通过在该层执行某些动作或使用直接下层的服务来来提供服务

协议栈： 各层的所有协议 ：（由下到上） 1. 物理层 2. 链路层 3. 网络层 4. 运输层 5. 应用层
```
1. 应用层 ： 网络应用程序及他们的应用层协议存留的地方

HTTP (web文档的请求和帮助) ，
SMTP (电子邮件报文的传输) ，
FTP (端系统之间文件的传送)
DNS (域名系统)

报文 ： 位于应用层的信息分组
```
```
2. 运输层 : 在应用程序端点之间传送应用层报文

有两种运输协议
TCP (提供面向连接的服务)
1. 应用层报文向目的地的确保传递和流量控制 2. 长报文划分为短报文，提供拥塞控制系统(当网络拥塞时，源抑制其传输速率)

UDP (提供无连接服务)
不提供不必要的服务

报文段：运输层的分组
```
```
3. 网络层 : 负责将数据报的网络层分组从一台主机移动到另一台主机

运输层协议(TCP或UDP)向网络层递交传输层 报文段 和 目的地址

IP (网络协议)，定义了数据报的各个字段 以及 端系统和路由器如何作用与这些字段
路由选择协议

数据报: 网络层分组
```
```
4. 链路层：为将分组从一个节点(主机或路由器)移动到下一个节点，网络层必须依靠链路层的服务，在这个过程中 网络层将受到来自每个不同链路层协议的不同服务

网络层将数据下传个链路层 链路层沿着路径将数据传递给下一个节点 ，在下个节点 链路层将数据报上传个网络层

以太网,wifi和电缆接入网的DOCSIS协议 

帧：链路层分组
```
```
5. 物理层 ： 将帧中的一个个比特从一个节点移动到下个节点

与该链路的实际传输媒体相关联
```
OSI 模型
```
相比因特网协议栈多了 表示层 和 会话层

```

#### 封装

链路层交换机： 链路层和物理层

路由器 : 网络层 链路层，物理层   (能识别IP)

一个分组具有两种类型的字段 :首部字段和有效载荷字段 ,首部字段是在该层添加的 ，有效载荷字段一般来自于上一层的分组

<h2 id='1-6'>面对攻击的网络</h2>

#### 将有害程序放入计算机中

`病毒`: 需要某种形式的用户交互来感染用户设备的恶意软件(如 电子邮件附件)

`蠕虫`：无需任意明显用户交互就能进入设备的恶意软件

#### 攻击服务器和网络基础设施

`拒绝服务攻击(DoS)` : 弱点攻击(攻击易受攻击的应用程序或操作系统)  带宽洪泛(发送大量分组，如 分布式DoS)   连接洪泛 (在目标主机 创建大量半开或全开的TCP连接)

#### 嗅探分组

分组嗅探器 ： 记录每个流经的分组副本的被动接收器

#### 伪装成信任对象

<h1 id='2'>应用层</h2>

<h2 id='2-1'>应用层协议原理</h2>

### 网络应用程序体系结构

应用程序体系结构 ：1.  客户 - 服务器 体系结构   2. P2P体系 结构
```
客户 - 服务器 体系结构  (例如 搜索引擎 因特网商务 社交网络 基于web的电子邮件)
what: 有一个总是打开的服务器 服务于来自许多其他称为客户的主机的请求
特点 ： 1. 客户之间不直接通信 2. 该服务器具有固定的周知的地址
优点: 安全 性能高 可靠 IP固定能访问
缺点：对服务器性能要求高  服务提供商要支付互联和宽带费用 
```
```
P2P 体系结构 (例如 文件共享 对等方协助下载器 因特网电话和视频会议)
what： 对位于数据中心的专用服务器有着最小程度依赖
特点：  应用程序在客户之间直接通信  服务器被用于追踪用户Ip地址 ，但用户到用户的报文在用户主机间直接传输
优点：自拓展性 (每个用户为系统增加服务能力) ,对服务器要求小，成本低
缺点:面临安全性 性能 和可靠性的挑战
```
### 进程通信

what:两个不同端系统上的进程，通过跨越计算机网络交换报文而相互通信

#### 客户与服务器进程

在一对进程的通信会话中，发起通信的进程被标记为客户 ，在会话开始时等待联系的被标记为服务器

#### 进程与计算机网络之间的接口

进程通过`套接字`的软件接口向网络发送报文和向网络接收报文

what套接字: 应用程序和网络之间的 `应用程序编程接口(API)` 

应用程序对运输层的控制仅限于 1. 选择运输层协议 2. 能设定几个运输层参数(如最大缓存和最大报文段长度)

#### 进程寻址

标识接收进程 ： 1. 主机地址 (IP地址)   2. 在目的主机指定接收进程的标识符 (端口号)

### 可提供应用程序使用的运输服务

运输层协议为应用程序提供的服务 : 1. 可靠数据传输 2. 吞吐量 3. 定时 4. 安全性

#### 可靠数据传输

能保证进程传输数据无差错到达另一进程

#### 吞吐量

what： 发送进程能够向接收进程交付比特的速率

带宽敏感应用 ，对吞吐量高要求 (如 多媒体应用 视频电话)   弹性应用 (如 电子邮件等)

#### 定时

时延

#### 安全性

加密数据

### 因特网提供的运输服务

UDP和TCP

#### TCP

提供 面向连接服务和 可靠数据传输

面向连接服务 : 在应用层报文传递之前 ，先进行握手(客户和服务器相互交换运输层控制信息)，握手后 TCP连接 建立
，双方进程可以同时进行报文收发 ，接收报文发送时，连接拆除

可靠数据传输： 没有字节的丢失和冗余

拥塞控制机制 

用SSL(TCP的加强)来提高安全性 ，在应用层实现

#### UDP

仅提供最小服务 (因特网电话 因为能容忍某些丢失但对速度有要求)

#### 因特网运输协议所不提供的服务

吞吐量 和 定时保证 

### 应用层协议

应用层协议定义 ： 1. 交换的报文类型 2. 各种报文类型的语法 3. 字段的语义 4. 确定一个进程何时已经如何发送报文，对该报文响应的规则

### 本书涉及的网络应用

Web ， 文件传输 ， 电子邮件 ， 目录服务(DNS):网络名字到网络地址的转换 ， 流式视频 ， P2P

<h2 id='2-2'>Web和HTTP</h2>

### HTTP概况

what: 超文本传输协议 

实现: 客服程序和服务器程序 通过交换HTTP报文进行会话 ，HTTP定义了这些报文的结构以及客户和服务器进行报文交换的方式

HTTP使用TCP作为传输协议，HTTP客户首先发起与服务器的TCP连接 ,连接成功后 ( 客户 通过套接字接口发生HTTP报文 报文进入TCP控制 发送到服务器 套接字接口 然后服务器接收 )

HTTP 是`无状态协议`： 不保存用户信息

### 非持续连接和持续连接

客户发送一系列请求， 每个请求/响应由单独的 TCP 连接发送  (非持续连接) ,由相同TCP发送 (持续连接)

#### 采用非持续连接的HTTP

例如 从服务器向客户传送以一个包含 1个HTML基本文件和10个JPEG图形 ，该HTML他的URL为
http:// www.aa.com/bb.index

1. HTTP客户进程向端口号80 发送一个到服务器 www.aa.com 的TCP连接

2. HTTP客户经它的套接字向服务器发送一个HTTP请求报文，该报文包含路径/bb.index

3. HTTP服务器经他的套接字接收该报文请求，从他的存储器检索/bb.index ，在一个HTTP响应报文中封装对象，并通过器套接字向客户发送响应报文

4. HTTP服务器通知TCP 断开TCP连接 (实际断开直到TCP确认用户接收到响应报文为止)

5. HTTP客户接收响应报文，TCP连接关闭，客户从响应报文中提取该文件，并得到对10个JPEG图形的引用

6. 对每个引用的JPEG文件重复前4 个步骤

在本例子中 ，用户请求该Web页面 要建立 11个TCP连接(可能为 串行 或 并行)

往返时间(RTT)： 指一个短分组从客户到服务器然在返回客户所花费的时间

用户点击超链接时的响应时间: 浏览器建立和Web服务器的TCP连接，这涉及三次握手 (用户向服务器发送一个小TCP报文段， 服务器用小TCP报文段做出确认和响应 ，用户向服务器返回确认 ) ，三次握手前两个部分占用一个RTT ，第三部分确认过程中向该TCP连接发送一个HTTP请求报文，一旦报文达到服务器，服务器就在该TCP上发送HTML文件，占用一个RTT
所以总时间为 两个 RTT 和 传输HTML的时间

缺点: 1. 必须为每一个请求对象建立和维护一个全新的TCP连接 (给Web服务器带来负担)  2. 每一个对象都要经受两倍的RTT 的交付时延

#### 采用连续连接的HTTP

服务器发送响应后保持该TCP连接打开, 直到一定时间间隔未被使用然后关闭

### HTTP报文格式

#### 请求报文

例如
```
GET /somedir/page.html HTTP/1.1 //请求行 (方法字段  URL字段  HTTP版本字段 )
Host: www.someschool.edu // 首部行 ，指明的 对象所在主机
Connection: close  // 要不要使用持续连接 否
User-agent: Mozilla/5.0 //  向服务器发送请求的浏览器类型 ： 这里是火狐
Accept-language: fr // 要求返回的版本类型   法语版本
```
方法字段 : 1. GET (浏览器请求一个对象) 2. POST (用表单生成的请求报文，在 实体体中包括用户在表单中的输入值) 3. HEAD (类型GET，但不返回请求对象，常用于开发 调试与跟踪) 4. PUT (允许用户上传对象到指定的Web服务器上指定的路径) 5. DELETE (删除Web服务器上的对象)

#### 响应报文

类似
```
HTTP/1.1 200 ok  // 状态栏 (协议版本字段  状态码 相应状态信息)
// 6个首部行
Connection: close  // 发送完报文后关闭TCP连接
Date: Tue,  18 Aug 2015 15:44:04 GMT // 首部行指示服务器尝试并发送该响应报文的日期和时间(服务器从他的
                                文件系统中检索到该对象，并将该对象插入响应报文，并发送该响应报文时间)
Server: Apache/2.2.3(CentOS) // 指示该报文是一台Apache Web服务器产生的
Last-Modified: Tue,  18 Aug 2015 15:11:03 GMT // 对象创建或最后修改日期和时间
Content-Length: 6821  // 被发送对象中的字节数
Content-Type: text/html // 实体体中的对象时 HTML文本

(data data data data data ...)  //实体体，报文主要内容包含所请求对象本身
```
### 用户和服务器的交互 : cookie

cookie ： 允许站点对用户进行追踪

4个部件： 1. 在HTTP响应报文中的一个cookie首部行 2. 在HTTP请求报文中的一个cookie首部行 3. 在用户端系统中保留一个cookie 由用户浏览器进行管理 4. 位于Web站点后端数据库中 

### Web缓存

Web缓存器也称代理服务器，能代表初始服务器来满足HTTP请求的网络实体

存在Web缓存器时，客户请求对象，会先检查Web服务器有无该对象，若有直接返回 ，若无 ，请求初始服务器，对象会先传输给Web缓存器且在本地存储副本，在传输给客户

优点：能有效降低时延且成本低

通过内容分发网络(CDN) ，web缓存器发挥越来越重要作用

### 条件GET方法

尽管web缓存能降低用户感受到的响应时间，不过有个问题，web缓存器中可能存的对象副本是陈旧的。

HTTP的条件GET，允许web缓存器证明它存的是最新的

条件GET格式： 1. 请求报文使用GET方法 2. 请求报文中包含一个"If-Modified-Since:"

因为对象的属性中有一个是 最后修改时间，当客户请求web缓存器时 ，web缓存器会先向初始服务器发送一个条件GET，
如果最后修改时间相同则代表最新 ，否则从初始服务器下载对象，然后保存副本
```
条件GET

GET /somedir/page.html HTTP/1.1
Host: www.someschool.edu 
If-Modified-Since: Tue,  18 Aug 2015 15:11:03 
```

<h2 id='2-3'>因特网中的电子邮件</h2>




